import{r,o as S,e as a,k as e,l as p,t as s,n as R,w as V,m as y,v as b,s as U,h as u}from"./vendor-wTwM5GbD.js";import{u as h}from"./index-CNyJ74Tt.js";import{u as B}from"./repository-CCfrAeA1.js";import{a as m}from"./mdui-B9C5XAKh.js";import{_ as M}from"./_plugin-vue_export-helper-DlAUqK2U.js";const N={class:"dashboard-layout"},T={class:"content-area"},E={key:0,style:{"text-align":"center",padding:"48px"}},j={key:1},q={class:"repo-header"},z={class:"repo-description"},A={class:"repo-badges"},F={key:0},I={key:1},L={style:{padding:"24px","margin-top":"24px"}},G={class:"code-block"},H={style:{padding:"24px","margin-top":"24px"}},J={key:2,style:{padding:"48px","text-align":"center"}},K=["open"],O=["loading"],P={__name:"RepositoryDetail",setup(Q){const x=U(),v=h(),c=B(),g=r(!1),f=r(!1),d=r(!1),o=r(null),n=r({name:"",description:"",is_public:!1});async function $(){g.value=!0;try{o.value=await c.fetchRepository(x.params.id),n.value={name:o.value.name,description:o.value.description,is_public:o.value.is_public}}catch{m({message:"加载仓库失败",placement:"top"})}finally{g.value=!1}}async function k(){f.value=!0;try{await c.updateRepository(x.params.id,n.value),o.value=c.currentRepository,m({message:"仓库更新成功！",icon:"done",placement:"top"}),d.value=!1}catch(l){m({message:l.error||"更新仓库失败",placement:"top"})}finally{f.value=!1}}function D(){var t;const l=`git clone http://localhost:8080/${(t=v.user)==null?void 0:t.username}/${o.value.name}.git`;navigator.clipboard.writeText(l).then(()=>{m({message:"已复制到剪贴板",icon:"done",placement:"bottom"})})}function _(l){return new Date(l).toLocaleString("zh-CN")}return S(()=>{$()}),(l,t)=>{var w,C;return u(),a("div",N,[e("mdui-top-app-bar",null,[e("mdui-button-icon",{icon:"arrow_back",onClick:t[0]||(t[0]=i=>l.$router.back())}),t[8]||(t[8]=e("mdui-top-app-bar-title",null,"仓库详情",-1)),t[9]||(t[9]=e("div",{style:{"flex-grow":"1"}},null,-1)),e("mdui-button-icon",{icon:"settings",onClick:t[1]||(t[1]=i=>d.value=!0)})]),e("div",T,[g.value?(u(),a("div",E,[...t[10]||(t[10]=[e("mdui-circular-progress",null,null,-1)])])):o.value?(u(),a("div",j,[e("div",q,[e("div",null,[e("h1",null,[t[11]||(t[11]=e("mdui-icon",{name:"folder"},null,-1)),p(" "+s(o.value.name),1)]),e("p",z,s(o.value.description||"无描述"),1),e("div",A,[o.value.is_public?(u(),a("mdui-chip",F," 公开 ")):(u(),a("mdui-chip",I," 私有 "))])])]),e("mdui-card",L,[t[12]||(t[12]=e("h2",null,"克隆仓库",-1)),e("div",G,[e("code",null,"git clone http://localhost:8080/"+s((w=R(v).user)==null?void 0:w.username)+"/"+s(o.value.name)+".git",1),e("mdui-button-icon",{icon:"content_copy",onClick:D})])]),e("mdui-card",H,[t[16]||(t[16]=e("h2",null,"仓库信息",-1)),e("mdui-list",null,[e("mdui-list-item",null,[t[13]||(t[13]=e("strong",null,"创建时间:",-1)),p(" "+s(_(o.value.created_at)),1)]),e("mdui-list-item",null,[t[14]||(t[14]=e("strong",null,"更新时间:",-1)),p(" "+s(_(o.value.updated_at)),1)]),e("mdui-list-item",null,[t[15]||(t[15]=e("strong",null,"所有者:",-1)),p(" "+s((C=R(v).user)==null?void 0:C.username),1)])])]),t[17]||(t[17]=e("mdui-card",{style:{padding:"24px","margin-top":"24px"}},[e("div",{style:{display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"16px"}},[e("h2",null,"协作者"),e("mdui-button",{variant:"outlined",icon:"person_add"}," 添加协作者 ")]),e("p",{style:{opacity:"0.7"}}," 暂无协作者 ")],-1))])):(u(),a("mdui-card",J,[t[18]||(t[18]=e("p",null,"仓库不存在或已被删除",-1)),e("mdui-button",{onClick:t[2]||(t[2]=i=>l.$router.push("/repositories"))}," 返回仓库列表 ")]))]),e("mdui-dialog",{open:d.value,onClose:t[7]||(t[7]=i=>d.value=!1)},[t[19]||(t[19]=e("mdui-dialog-headline",null,"编辑仓库",-1)),e("mdui-dialog-body",null,[e("form",{onSubmit:V(k,["prevent"])},[y(e("mdui-text-field",{"onUpdate:modelValue":t[3]||(t[3]=i=>n.value.name=i),label:"仓库名称",required:"",disabled:""},null,512),[[b,n.value.name]]),y(e("mdui-text-field",{"onUpdate:modelValue":t[4]||(t[4]=i=>n.value.description=i),label:"描述",style:{"margin-top":"16px"}},null,512),[[b,n.value.description]]),y(e("mdui-checkbox",{"onUpdate:modelValue":t[5]||(t[5]=i=>n.value.is_public=i),style:{"margin-top":"16px"}}," 公开仓库 ",512),[[b,n.value.is_public]])],32)]),e("mdui-dialog-actions",null,[e("mdui-button",{onClick:t[6]||(t[6]=i=>d.value=!1)}," 取消 "),e("mdui-button",{variant:"filled",loading:f.value,onClick:k}," 保存 ",8,O)])],40,K)])}}},et=M(P,[["__scopeId","data-v-05fd5da3"]]);export{et as default};
