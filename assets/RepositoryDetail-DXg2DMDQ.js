import{r,o as S,e as a,k as t,l as p,t as s,n as R,w as V,m as y,v as b,s as U,u as h,h as u}from"./vendor-wTwM5GbD.js";import{u as B}from"./index-Cw8dJ5sJ.js";import{u as M}from"./repository-C335MaUT.js";import{a as m}from"./mdui-B9C5XAKh.js";import{_ as N}from"./_plugin-vue_export-helper-DlAUqK2U.js";const T={class:"dashboard-layout"},E={class:"content-area"},j={key:0,style:{"text-align":"center",padding:"48px"}},q={key:1},z={class:"repo-header"},A={class:"repo-description"},F={class:"repo-badges"},I={key:0},L={key:1},G={style:{padding:"24px","margin-top":"24px"}},H={class:"code-block"},J={style:{padding:"24px","margin-top":"24px"}},K={key:2,style:{padding:"48px","text-align":"center"}},O=["open"],P=["loading"],Q={__name:"RepositoryDetail",setup(W){const x=U();h();const v=B(),c=M(),g=r(!1),f=r(!1),d=r(!1),o=r(null),n=r({name:"",description:"",is_public:!1});async function $(){g.value=!0;try{o.value=await c.fetchRepository(x.params.id),n.value={name:o.value.name,description:o.value.description,is_public:o.value.is_public}}catch{m({message:"加载仓库失败",placement:"top"})}finally{g.value=!1}}async function k(){f.value=!0;try{await c.updateRepository(x.params.id,n.value),o.value=c.currentRepository,m({message:"仓库更新成功！",icon:"done",placement:"top"}),d.value=!1}catch(l){m({message:l.error||"更新仓库失败",placement:"top"})}finally{f.value=!1}}function D(){var e;const l=`git clone http://localhost:8080/${(e=v.user)==null?void 0:e.username}/${o.value.name}.git`;navigator.clipboard.writeText(l).then(()=>{m({message:"已复制到剪贴板",icon:"done",placement:"bottom"})})}function _(l){return new Date(l).toLocaleString("zh-CN")}return S(()=>{$()}),(l,e)=>{var w,C;return u(),a("div",T,[t("mdui-top-app-bar",null,[t("mdui-button-icon",{icon:"arrow_back",onClick:e[0]||(e[0]=i=>l.$router.back())}),e[8]||(e[8]=t("mdui-top-app-bar-title",null,"仓库详情",-1)),e[9]||(e[9]=t("div",{style:{"flex-grow":"1"}},null,-1)),t("mdui-button-icon",{icon:"settings",onClick:e[1]||(e[1]=i=>d.value=!0)})]),t("div",E,[g.value?(u(),a("div",j,[...e[10]||(e[10]=[t("mdui-circular-progress",null,null,-1)])])):o.value?(u(),a("div",q,[t("div",z,[t("div",null,[t("h1",null,[e[11]||(e[11]=t("mdui-icon",{name:"folder"},null,-1)),p(" "+s(o.value.name),1)]),t("p",A,s(o.value.description||"无描述"),1),t("div",F,[o.value.is_public?(u(),a("mdui-chip",I,"公开")):(u(),a("mdui-chip",L,"私有"))])])]),t("mdui-card",G,[e[12]||(e[12]=t("h2",null,"克隆仓库",-1)),t("div",H,[t("code",null,"git clone http://localhost:8080/"+s((w=R(v).user)==null?void 0:w.username)+"/"+s(o.value.name)+".git",1),t("mdui-button-icon",{icon:"content_copy",onClick:D})])]),t("mdui-card",J,[e[16]||(e[16]=t("h2",null,"仓库信息",-1)),t("mdui-list",null,[t("mdui-list-item",null,[e[13]||(e[13]=t("strong",null,"创建时间:",-1)),p(" "+s(_(o.value.created_at)),1)]),t("mdui-list-item",null,[e[14]||(e[14]=t("strong",null,"更新时间:",-1)),p(" "+s(_(o.value.updated_at)),1)]),t("mdui-list-item",null,[e[15]||(e[15]=t("strong",null,"所有者:",-1)),p(" "+s((C=R(v).user)==null?void 0:C.username),1)])])]),e[17]||(e[17]=t("mdui-card",{style:{padding:"24px","margin-top":"24px"}},[t("div",{style:{display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"16px"}},[t("h2",null,"协作者"),t("mdui-button",{variant:"outlined",icon:"person_add"}," 添加协作者 ")]),t("p",{style:{opacity:"0.7"}},"暂无协作者")],-1))])):(u(),a("mdui-card",K,[e[18]||(e[18]=t("p",null,"仓库不存在或已被删除",-1)),t("mdui-button",{onClick:e[2]||(e[2]=i=>l.$router.push("/repositories"))},"返回仓库列表")]))]),t("mdui-dialog",{open:d.value,onClose:e[7]||(e[7]=i=>d.value=!1)},[e[19]||(e[19]=t("mdui-dialog-headline",null,"编辑仓库",-1)),t("mdui-dialog-body",null,[t("form",{onSubmit:V(k,["prevent"])},[y(t("mdui-text-field",{"onUpdate:modelValue":e[3]||(e[3]=i=>n.value.name=i),label:"仓库名称",required:"",disabled:""},null,512),[[b,n.value.name]]),y(t("mdui-text-field",{"onUpdate:modelValue":e[4]||(e[4]=i=>n.value.description=i),label:"描述",style:{"margin-top":"16px"}},null,512),[[b,n.value.description]]),y(t("mdui-checkbox",{"onUpdate:modelValue":e[5]||(e[5]=i=>n.value.is_public=i),style:{"margin-top":"16px"}}," 公开仓库 ",512),[[b,n.value.is_public]])],32)]),t("mdui-dialog-actions",null,[t("mdui-button",{onClick:e[6]||(e[6]=i=>d.value=!1)},"取消"),t("mdui-button",{variant:"filled",onClick:k,loading:f.value},"保存",8,P)])],40,O)])}}},oe=N(Q,[["__scopeId","data-v-a88f43b2"]]);export{oe as default};
