import{r as i,c as B,o as M,e as s,k as t,m as g,v as y,F as N,q as T,t as v,w as z,l as x,u as F,h as a}from"./vendor-wTwM5GbD.js";import{u as A}from"./index-Cw8dJ5sJ.js";import{u as E}from"./repository-C335MaUT.js";import{a as u}from"./mdui-B9C5XAKh.js";import{_ as I}from"./_plugin-vue_export-helper-DlAUqK2U.js";const O={class:"dashboard-layout"},Q=["open"],j={class:"content-area"},G={class:"page-header"},H={key:0,style:{"text-align":"center",padding:"48px"}},J={key:1,class:"repo-grid"},K={class:"repo-header"},P={class:"repo-title"},W={key:0},X={key:1},Y={class:"repo-description"},Z={class:"repo-meta"},ee={class:"repo-actions"},te=["onClick"],oe=["onClick"],le={key:2,style:{padding:"48px","text-align":"center"}},ie=["open"],ne=["loading"],se=["open"],ae=["loading"],ue={__name:"Repositories",setup(de){const D=F(),h=A(),d=E(),f=i(!1),r=i(!1),p=i(!1),m=i(""),b=i(!1),k=i(!1),C=i(!1),c=i(null),n=i({name:"",description:"",is_public:!1}),w=B(()=>{if(!m.value)return d.repositories;const l=m.value.toLowerCase();return d.repositories.filter(e=>e.name.toLowerCase().includes(l)||e.description&&e.description.toLowerCase().includes(l))});async function S(){b.value=!0;try{await d.fetchRepositories()}catch{u({message:"加载仓库失败",placement:"top"})}finally{b.value=!1}}async function $(){k.value=!0;try{await d.createRepository(n.value),u({message:"仓库创建成功！",icon:"done",placement:"top"}),r.value=!1,n.value={name:"",description:"",is_public:!1}}catch(l){u({message:l.error||"创建仓库失败",placement:"top"})}finally{k.value=!1}}function L(l){c.value=l,p.value=!0}async function V(){C.value=!0;try{await d.deleteRepository(c.value.id),u({message:"仓库已删除",icon:"done",placement:"top"}),p.value=!1,c.value=null}catch(l){u({message:l.error||"删除仓库失败",placement:"top"})}finally{C.value=!1}}function _(l){return new Date(l).toLocaleDateString("zh-CN")}function U(){h.logout(),u({message:"已退出登录",placement:"top"}),D.push("/")}return M(()=>{S()}),(l,e)=>{var R;return a(),s("div",O,[t("mdui-top-app-bar",null,[t("mdui-button-icon",{icon:"menu",onClick:e[0]||(e[0]=o=>f.value=!f.value)}),e[13]||(e[13]=t("mdui-top-app-bar-title",null,"我的仓库",-1)),e[14]||(e[14]=t("div",{style:{"flex-grow":"1"}},null,-1)),t("mdui-button-icon",{icon:"logout",onClick:U})]),t("mdui-navigation-drawer",{open:f.value,onClose:e[3]||(e[3]=o=>f.value=!1)},[t("mdui-list",null,[t("mdui-list-item",{icon:"dashboard",onClick:e[1]||(e[1]=o=>l.$router.push("/dashboard"))}," 仪表盘 "),t("mdui-list-item",{icon:"folder",onClick:e[2]||(e[2]=o=>l.$router.push("/repositories"))}," 我的仓库 "),e[15]||(e[15]=t("mdui-list-item",{icon:"settings"}," 设置 ",-1))])],40,Q),t("div",j,[t("div",G,[e[16]||(e[16]=t("h1",null,"我的仓库",-1)),t("mdui-button",{variant:"filled",icon:"add",onClick:e[4]||(e[4]=o=>r.value=!0)}," 创建仓库 ")]),g(t("mdui-text-field",{"onUpdate:modelValue":e[5]||(e[5]=o=>m.value=o),placeholder:"搜索仓库...",icon:"search",style:{"margin-bottom":"24px",width:"100%"}},null,512),[[y,m.value]]),b.value?(a(),s("div",H,[...e[17]||(e[17]=[t("mdui-circular-progress",null,null,-1)])])):w.value.length>0?(a(),s("div",J,[(a(!0),s(N,null,T(w.value,o=>(a(),s("mdui-card",{key:o.id,class:"repo-card"},[t("div",K,[e[18]||(e[18]=t("mdui-icon",{name:"folder",class:"repo-icon"},null,-1)),t("div",P,[t("h3",null,v(o.name),1),o.is_public?(a(),s("mdui-chip",W,"公开")):(a(),s("mdui-chip",X,"私有"))])]),t("p",Y,v(o.description||"无描述"),1),t("div",Z,[t("span",null,[e[19]||(e[19]=t("mdui-icon",{name:"schedule"},null,-1)),x(" "+v(_(o.created_at)),1)])]),t("div",ee,[t("mdui-button",{variant:"text",icon:"info",onClick:q=>l.$router.push(`/repositories/${o.id}`)}," 详情 ",8,te),t("mdui-button",{variant:"text",icon:"delete",onClick:q=>L(o)}," 删除 ",8,oe)])]))),128))])):(a(),s("mdui-card",le,[e[20]||(e[20]=t("mdui-icon",{name:"inbox",style:{"font-size":"64px",opacity:"0.3"}},null,-1)),t("p",null,v(m.value?"没有找到匹配的仓库":"还没有仓库，创建第一个仓库吧！"),1)]))]),t("mdui-dialog",{open:r.value,onClose:e[10]||(e[10]=o=>r.value=!1)},[e[21]||(e[21]=t("mdui-dialog-headline",null,"创建新仓库",-1)),t("mdui-dialog-body",null,[t("form",{onSubmit:z($,["prevent"])},[g(t("mdui-text-field",{"onUpdate:modelValue":e[6]||(e[6]=o=>n.value.name=o),label:"仓库名称",required:"",helper:"只能包含字母、数字、连字符和下划线"},null,512),[[y,n.value.name]]),g(t("mdui-text-field",{"onUpdate:modelValue":e[7]||(e[7]=o=>n.value.description=o),label:"描述",style:{"margin-top":"16px"}},null,512),[[y,n.value.description]]),g(t("mdui-checkbox",{"onUpdate:modelValue":e[8]||(e[8]=o=>n.value.is_public=o),style:{"margin-top":"16px"}}," 公开仓库 ",512),[[y,n.value.is_public]])],32)]),t("mdui-dialog-actions",null,[t("mdui-button",{onClick:e[9]||(e[9]=o=>r.value=!1)},"取消"),t("mdui-button",{variant:"filled",onClick:$,loading:k.value},"创建",8,ne)])],40,ie),t("mdui-dialog",{open:p.value,onClose:e[12]||(e[12]=o=>p.value=!1)},[e[24]||(e[24]=t("mdui-dialog-headline",null,"确认删除",-1)),t("mdui-dialog-body",null,[e[22]||(e[22]=x(" 确定要删除仓库 ",-1)),t("strong",null,v((R=c.value)==null?void 0:R.name),1),e[23]||(e[23]=x(" 吗？此操作不可撤销。 ",-1))]),t("mdui-dialog-actions",null,[t("mdui-button",{onClick:e[11]||(e[11]=o=>p.value=!1)},"取消"),t("mdui-button",{variant:"filled",onClick:V,loading:C.value},"删除",8,ae)])],40,se)])}}},ce=I(ue,[["__scopeId","data-v-dea0d6bb"]]);export{ce as default};
